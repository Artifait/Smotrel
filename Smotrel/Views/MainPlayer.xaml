<Window x:Class="Smotrel.Views.MainPlayer"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:ctrls="clr-namespace:Smotrel.Controls"
        Title="Smotrel Player"
        Height="450" MinHeight="400"
        Width="800" MinWidth="620"
        WindowStartupLocation="CenterScreen"
        WindowStyle="None"
        AllowsTransparency="True"
        WindowState="Maximized"
        Background="Transparent"
        ResizeMode="CanResizeWithGrip"
        StateChanged="OnWindowStateChanged"
        KeyDown="MainPlayer_KeyDown">

    <Border Background="{StaticResource WindowBackgroundBrush}"
            BorderThickness="1"
            BorderBrush="{StaticResource BorderBrush}"
            CornerRadius="10">

        <!--
        ═══════════════════════════════════════════════════════
          ROOT GRID — Normal / Fullscreen — занимают одну ячейку
        ═══════════════════════════════════════════════════════
        -->
        <Grid>

            <!-- ═══ NORMAL MODE ════════════════════════════════════════════════ -->
            <Grid x:Name="NormalLayout">
                <Grid.RowDefinitions>
                    <RowDefinition x:Name="DamperGap"     Height="0"/>
                    <RowDefinition x:Name="GapDefinition" Height="45"/>
                    <RowDefinition Height="*"/>
                </Grid.RowDefinitions>

                <!-- ── Заголовок ──────────────────────────────────────────────── -->
                <Border x:Name="GapWindow"
                        Grid.Row="1"
                        Background="{StaticResource HeaderBackgroundBrush}"
                        MouseLeftButtonDown="Header_Down"
                        CornerRadius="9,9,0,0">
                    <Grid>
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition x:Name="backBtnDamper"               Width="0"/>
                            <ColumnDefinition Width="40"/>
                            <ColumnDefinition Width="*"/>
                            <ColumnDefinition x:Name="ColumnOfWindowManagmentBtns" Width="120"/>
                            <ColumnDefinition x:Name="exitBtnDamper"               Width="0"/>
                        </Grid.ColumnDefinitions>

                        <!-- Назад -->
                        <Button x:Name="BackBtn"
                                Grid.Column="1"
                                Width="40" Content="&#xF0D5;"
                                FontFamily="Segoe MDL2 Assets"
                                Foreground="{StaticResource GlyphBrush}"
                                Click="BackButton_Click" FontSize="18"
                                ToolTip="Главное меню"
                                Style="{StaticResource SettingsBtn}"/>

                        <!-- Заголовок курса -->
                        <TextBlock x:Name="GapTitle"
                                   Grid.Column="2"
                                   Text="Smotrel"
                                   HorizontalAlignment="Center"
                                   VerticalAlignment="Center"
                                   FontFamily="Rockwell"
                                   TextTrimming="CharacterEllipsis"
                                   Foreground="{StaticResource GlyphBrush}"
                                   FontSize="24" FontWeight="SemiBold"/>

                        <!-- Кнопки окна -->
                        <StackPanel Grid.Column="3" Orientation="Horizontal">
                            <Button Width="40" Content="&#xE921;"
                                    FontFamily="Segoe MDL2 Assets"
                                    Foreground="{StaticResource WhiteBrush}"
                                    Click="MinimizeButton_Click"
                                    Style="{StaticResource CapBtn}"/>
                            <Button Width="40" Content="&#xE922;"
                                    FontFamily="Segoe MDL2 Assets"
                                    Foreground="{StaticResource WhiteBrush}"
                                    Click="MaximizeRestoreButton_Click"
                                    Style="{StaticResource CapBtn}"/>
                            <Button x:Name="ExitBtn"
                                    Width="40" Content="&#xE8BB;"
                                    FontFamily="Segoe MDL2 Assets"
                                    Foreground="{StaticResource WhiteBrush}"
                                    Click="CloseButton_Click"
                                    Style="{StaticResource ExitBtn}"/>
                        </StackPanel>
                    </Grid>
                </Border>

                <!-- ── Контент: плеер + разделитель + сайдбар ────────────────── -->
                <Grid Grid.Row="2">
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition x:Name="SidebarColumn" Width="280" MinWidth="180"/>
                        <ColumnDefinition Width="Auto"/>
                        <ColumnDefinition Width="*"   MinWidth="320"/>
                    </Grid.ColumnDefinitions>

                    <!--
                        PlayerNormal — плеер в Normal режиме.
                        Горячие клавиши перехватываются в MainPlayer_KeyDown и
                        делегируются в ActivePlayer.HandleHotkey().
                    -->
                    <ctrls:SmotrelPlayer
                        x:Name="PlayerNormal"
                        Grid.Column="2"
                        OverlayTimeout="00:00:03"
                        PlaybackStateChanged="Player_PlaybackStateChanged"
                        PlaybackEnded="Player_PlaybackEnded"
                        PreviousRequested="Player_PreviousRequested"
                        NextRequested="Player_NextRequested"
                        VolumeChangedRouted="Player_VolumeChanged"
                        VideoWindowStateChanged="Player_WindowStateChanged"/>

                    <!-- Разделитель -->
                    <GridSplitter Grid.Column="1" Width="4"
                                  HorizontalAlignment="Center"
                                  VerticalAlignment="Stretch"
                                  Background="{StaticResource BorderBrush}"
                                  Cursor="SizeWE"
                                  ResizeBehavior="PreviousAndNext"/>

                    <!-- Боковая навигационная панель (placeholder) -->
                    <Border x:Name="Sidebar"
                            Grid.Column="0"
                            Background="{StaticResource StatsPanelBackgroundBrush}"
                            BorderBrush="{StaticResource BorderBrush}"
                            BorderThickness="1,0,0,0">
                        <TextBlock Text="Навигация по курсу"
                                   Foreground="{StaticResource EmptyMessageBrush}"
                                   HorizontalAlignment="Center"
                                   VerticalAlignment="Center"
                                   FontSize="14" FontFamily="Arial"
                                   FontStyle="Italic"/>
                    </Border>
                </Grid>
            </Grid>

            <!-- ═══ FULLSCREEN MODE ═════════════════════════════════════════════ -->
            <!--
                PlayerFullscreen находится здесь постоянно.
                В Normal режиме: Visibility=Collapsed + IsLocked=True (блокирован).
                В Fullscreen режиме: NormalLayout=Collapsed, FullscreenLayout=Visible.
            -->
            <Grid x:Name="FullscreenLayout" Visibility="Collapsed">
                <ctrls:SmotrelPlayer
                    x:Name="PlayerFullscreen"
                    PlayerMode="Fullscreen"
                    IsLocked="True"
                    OverlayTimeout="00:00:03"
                    PlaybackStateChanged="Player_PlaybackStateChanged"
                    PlaybackEnded="Player_PlaybackEnded"
                    PreviousRequested="Player_PreviousRequested"
                    NextRequested="Player_NextRequested"
                    VolumeChangedRouted="Player_VolumeChanged"
                    VideoWindowStateChanged="Player_WindowStateChanged"/>
            </Grid>

        </Grid>
    </Border>
</Window>
