<Window x:Class="Smotrel.Views.MainWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:vms="clr-namespace:Smotrel.ViewModels"
        Title="Smotrel Player" Height="600" Width="1000"
        Background="#1E1E1E" Foreground="White">

    <Window.Resources>
        <!-- Кнопки -->
        <Style TargetType="Button">
            <Setter Property="Background" Value="Transparent"/>
            <Setter Property="Foreground" Value="White"/>
            <Setter Property="BorderBrush" Value="Transparent"/>
            <Setter Property="FontSize" Value="16"/>
            <Setter Property="Padding" Value="5"/>
            <Setter Property="Margin" Value="5"/>
            <Setter Property="Cursor" Value="Hand"/>
        </Style>
        <!-- Slider для seek/bar -->
        <Style TargetType="Slider">
            <Setter Property="Foreground" Value="White"/>
            <Setter Property="Background" Value="#333"/>
        </Style>
    </Window.Resources>

    <Grid>
        <Grid.ColumnDefinitions>
            <ColumnDefinition Width="350"/>
            <ColumnDefinition Width="*"/>
        </Grid.ColumnDefinitions>

        <!-- Левая панель -->
        <StackPanel Grid.Column="0" Margin="5">
            <Button Content="📂 Выбрать папку" Command="{Binding BrowseCommand}"/>

            <TreeView Margin="5"
                      ItemsSource="{Binding Root.SubFolders}"
                      Background="#2A2A2A" Foreground="White">
                <TreeView.ItemTemplate>
                    <HierarchicalDataTemplate DataType="{x:Type vms:FolderNodeViewModel}"
                                              ItemsSource="{Binding SubFolders}">
                        <TextBlock Text="{Binding Title}" FontWeight="Bold">
                            <TextBlock.InputBindings>
                                <MouseBinding Gesture="LeftDoubleClick"
                                              Command="{Binding OpenFolderCommand}"/>
                            </TextBlock.InputBindings>
                        </TextBlock>
                    </HierarchicalDataTemplate>
                </TreeView.ItemTemplate>
            </TreeView>

            <ListBox ItemsSource="{Binding Playlist}"
                     SelectedItem="{Binding SelectedVideo}"
                     DisplayMemberPath="Title"
                     Background="#2A2A2A" Foreground="White"
                     Height="400"/>
        </StackPanel>

        <!-- Правая панель: плеер с оверлеем -->
        <Grid Grid.Column="1" Margin="5">
            <!-- контейнер для Media + оверлея -->
            <Grid x:Name="PlayerContainer"
                  MouseEnter="PlayerContainer_MouseEnter"
                  MouseLeave="PlayerContainer_MouseLeave"
                  MouseMove="PlayerContainer_MouseMove"
                  SizeChanged="PlayerContainer_SizeChanged">
                <!-- Видео -->
                <MediaElement x:Name="Player"
                              Source="{Binding CurrentVideoPath}"
                              LoadedBehavior="Manual"
                              UnloadedBehavior="Stop"
                              Stretch="Uniform"
                              MouseLeftButtonDown="Player_MouseLeftButtonDown"
                              MediaOpened="Player_MediaOpened"/>

                <!-- Overlay controls -->
                <Grid x:Name="ControlOverlay"
                      VerticalAlignment="Bottom"
                      Background="#80000000"
                      Height="80"
                      Opacity="1"
                      Margin="0"
                      Visibility="Visible">

                    <Grid.RowDefinitions>
                        <RowDefinition Height="*"/>
                        <RowDefinition Height="Auto"/>
                    </Grid.RowDefinitions>

                    <!-- Прозрачная верхняя зона: ловит клик, но не перекрывает кнопки -->
                    <Border Grid.Row="0"
            Background="Transparent"
            MouseLeftButtonDown="Player_MouseLeftButtonDown" />

                    <!-- Панель с контролами -->
                    <StackPanel Grid.Row="1"
                Orientation="Vertical"
                Margin="20"
                IsHitTestVisible="True">
                        <!-- Слайдер времени -->
                        <Slider x:Name="videoSlider"
                Minimum="0"
                Maximum="100"
                ValueChanged="videoSlider_ValueChanged"
                PreviewMouseDown="Slider_PreviewMouseDown"
                PreviewMouseUp="Slider_PreviewMouseUp"/>

                        <!-- Иконки управления -->
                        <StackPanel Orientation="Horizontal"
                    HorizontalAlignment="Center"
                    Margin="0,10,0,0">
                            <Button Command="{Binding PrevCommand}" Content="⏮"/>
                            <Button Command="{Binding PausePlayCommand}" Content="⏯"/>
                            <Button Command="{Binding NextCommand}" Content="⏭"/>

                            <!-- Volume placeholder -->
                            <StackPanel Orientation="Horizontal" Margin="20,0">
                                <TextBlock Text="▬" FontSize="20"/>
                                <Ellipse Width="8" Height="8" Fill="White" Margin="-4,0"/>
                            </StackPanel>

                            <Button Command="{Binding FullscreenCommand}" Content="⛶"/>
                        </StackPanel>
                    </StackPanel>
                </Grid>
            </Grid>
        </Grid>
    </Grid>
</Window>
